{% load static %}
{% load bootstrap5 %}
<!DOCTYPE html>
<html>
<head>
    <title>{% block title %}{% endblock %}</title>
    {% bootstrap_css %}
    <!-- Include jQuery from a CDN -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <style>
        #iss-photo-container {
            width: 500px;
            height: 300px;
            overflow: hidden;
            position: relative;
        }

        #iss-photo {
            margin-top: 200px;
            width: 100%;
            height: auto;
            transition: transform 0.3s ease;
        }
    </style>

</head>
<body>
    <header>
        <h1>My Website</h1>
        <nav>
            <ul>
                <li><a href="">Home</a></li>
                <li><a href="">About</a></li>
                <li><a href="">Contact</a></li>
            </ul>
        </nav>
    </header>

    <main>
        {% block content %}{% endblock %}
    </main>

    <footer>
        <p>&copy; 2022 My Website. All rights reserved.</p>
    </footer>
    {% bootstrap_javascript %}
    <script>
  
    $(document).ready(function () {
        let scale = 1; // Initial scale factor
        let rotation = 0; // Initial rotation angle
        let offset = $('#iss-photo').offset();
   

        $('#zoom-in').click(function () {
            scale += 0.1; // Increase scale by 0.1
         
            updateTransform();
        });

        $('#zoom-out').click(function () {
            scale = Math.max(0.1, scale - 0.1); // Decrease scale by 0.1, minimum scale is 0.1
    
            updateTransform();
        });
        $('#rotate-left').click(function () {
            rotation -= 5; // Decrease rotation angle by 5 degrees
            updateTransform();
        });
        $('#rotate-right').click(function () {
            rotation += 5; // Increase rotation angle by 5 degrees
            updateTransform();
        });

        function updateTransform() {
            $('#iss-photo').css('transform', `scale(${scale}) rotate(${rotation}deg)`);
        }

        $('#iss-photo').on('click', function () {
            let text = "";

            // The distace from the (0,0) to the center, but the offset of the parent
            distX = this.parentElement.offsetLeft + this.parentElement.width / 2;
            distY = this.parentElement.offsetTop + this.parentElement.height / 2;
            text += `Distance X: ${distX.toFixed(2)}, Distance Y: ${distY.toFixed(2)}<br>`;

            // Get the bounding rectangle of the rotated and scaled image
            const rect = this.getBoundingClientRect();
            text += `Bounding Rect: ${JSON.stringify(rect)}<br>`;

            // Calculate the center of the image in the current transformed frame
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            text += `Center X: ${centerX.toFixed(2)}, Center Y: ${centerY.toFixed(2)}<br>`;

            // Get the click position relative to the viewport
            const clickX = event.clientX;
            const clickY = event.clientY;

            // Translate the click position to the image's center-based coordinate system
            const translatedX = (clickX - centerX) / scale;
            const translatedY = (clickY - centerY) / scale;

            // So, if no rotation is applied, the image center is the origin
            // and the click position is the translated position
            text += `Translated X: ${translatedX.toFixed(2)}, Translated Y: ${translatedY.toFixed(2)}<br>`;

            // Convert rotation to radians
            const rad = (Math.PI / 180) * rotation;

            // Calculate the inverse rotation matrix to map the click back to the original image coordinates
            const cosTheta = Math.cos(-rad);
            const sinTheta = Math.sin(-rad);

            // Apply the inverse transformation matrix to get the original image coordinates
            const originalX = (translatedX * cosTheta - translatedY * sinTheta) 
            const originalY = (translatedX * sinTheta + translatedY * cosTheta) 
            text += `Original X: ${originalX.toFixed(2)}, Original Y: ${originalY.toFixed(2)}<br>`;

            // Now, we add the center of the image to get the final coordinates
            const finalX = originalX + centerX;
            const finalY = originalY + centerY;
            text += `Final X: ${finalX.toFixed(2)}, Final Y: ${finalY.toFixed(2)}<br>`;

            // Get the natural size of the image (its original resolution)
            const naturalWidth = this.naturalWidth;
            const naturalHeight = this.naturalHeight;

            // Calculate the size ratio between the displayed size and the natural size
            const ratioX = naturalWidth / (rect.width / scale);
            const ratioY = naturalHeight / (rect.height / scale);

            // Adjust coordinates to the original resolution
            const px = originalX * ratioX;
            const py = originalY * ratioY;

            // Display the adjusted coordinates
            $('#coordinates').html = text;
            $('#coordinates').html(text);
            console.log(text);
        });
    });
</script>
    
</body>
</html>